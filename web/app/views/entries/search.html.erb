<% content_for(:title) { "Search \"#{@query}\" â€” Shipibo Dictionary" } %>

<div data-controller="search">
  <!-- Search -->
  <div class="mb-8">
    <%= form_with url: search_path, method: :get, class: "relative", data: { search_target: "form", action: "input->search#search submit->search#submitForm" } do |f| %>
      <svg class="absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 text-ink-muted pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
      </svg>
      <%= f.search_field :q,
          value: @query,
          placeholder: "Search Shipibo, Spanish, or English\u2026",
          class: "search-input",
          autocomplete: "off",
          data: { search_target: "input" } %>
    <% end %>
  </div>

  <div data-search-target="results">
    <% if @query.present? %>
      <!-- Results count -->
      <p class="text-sm text-ink-muted mb-4 font-light">
        <%= @entries.count %> <%= @entries.count == 1 ? "result" : "results" %> for
        <span class="font-semibold text-ink">"<%= @query %>"</span>
      </p>

      <% if @entries.any? %>
        <div class="entries-container">
          <% @entries.each do |entry| %>
            <%= link_to entry_path(entry), class: "entry-card" do %>
              <div class="flex items-baseline gap-2.5">
                <span class="font-display text-xl text-ink"><%= entry.headword %></span>
                <% if entry.part_of_speech.present? %>
                  <span class="badge"><%= entry.part_of_speech %></span>
                <% end %>
              </div>
              <% if entry.definitions_english.present? %>
                <p class="text-ink-light text-sm mt-1 leading-relaxed"><%= entry.definitions_english.first(3).join(" ; ") %></p>
              <% end %>
              <% if entry.definitions_spanish.present? %>
                <p class="text-ink-muted text-sm mt-0.5 italic leading-relaxed"><%= entry.definitions_spanish.first(2).join(" ; ") %></p>
              <% end %>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <div class="py-16 text-center">
          <p class="text-ink-muted mb-1">No entries found for "<%= @query %>"</p>
          <p class="text-sm text-ink-muted font-light">Try a different spelling or search in another language</p>
        </div>
      <% end %>
    <% else %>
      <div class="py-16 text-center">
        <p class="text-ink-muted">Type to search across Shipibo, Spanish, and English</p>
      </div>
    <% end %>
  </div>

  <div class="mt-8">
    <%= link_to root_path, class: "back-link" do %>
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
      Browse all entries
    <% end %>
  </div>
</div>
